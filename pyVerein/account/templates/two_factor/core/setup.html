{% extends 'app/base.html' %}
{% load i18n %}
{% load static %}
{% load widget_tweaks %}

{% block page_title %}
    {% trans 'Activate Two-Factor-Authentication' %}
{% endblock %}

{% block title %}
    {% trans 'Activate Two-Factor-Authentication' %}
{% endblock %}

{% block content %}
    <div class="main-narrow account form">
        <div class="detail-content mdc-elevation--z4">

            <form method="POST" id="form">
                {% csrf_token %}
                {{ wizard.management_form }}
                <div class="heading mdc-typography--overline">
                    {% blocktrans %}Activate Two-Factor-Authentication{% endblocktrans %}
                </div>
                <div>
                    {% if wizard.steps.current == 'welcome' %}
                        {% blocktrans %}You are about to take your account security to the next level. Follow the steps in this wizard to enable two-factor authentication.{% endblocktrans %}
                    {% elif wizard.steps.current == 'generator' %}
                        {% blocktrans %}To start using a token generator, please use your smartphone to scan the QR code below. For example, use Google Authenticator. Then, enter the token generated by the app.{% endblocktrans %}
                        <div>
                            <img src="{{ QR_URL }}" alt="QR Code" />
                        </div>
                    {% elif wizard.steps.current == 'validation' %}
                        {% if not challenge_succeeded %}
                            {% blocktrans %}We've encountered an issue with the selected authentication method. Please go back and verify that you entered your information correctly, try again, or use a different authentication method instead. If the issue persists, contact the site administrator.{% endblocktrans %}
                        {% endif %}
                    {% endif %}
                </div>
                {% if wizard.steps.current == 'welcome' %}
                    <div class="form-submit reverse">
                        <input type="submit" class="mdc-button mdc-button--raised" value="{% trans 'Next' %}" title="{% trans 'Next' %}" />
                        <a href="{% url 'account:detail' %}" class="mdc-button" title="{% trans 'Cancel' %}">{% trans 'Cancel' %}</a>
                    </div>
                {% elif wizard.steps.current == 'generator' %}
                    <div class="row">
                        <div class="mdc-text-field">
                            <input type="text" id="generator-token" name="generator-token" class="mdc-text-field__input" autofocus autocomplete="off" pattern="[0-9]{6}|[0-9]{8}">
                            <label class="mdc-floating-label" for="generator-token">
                                {% trans 'Code' %}
                            </label>
                            <div class="mdc-line-ripple"></div>
                        </div>
                    </div>
                    <div class="form-submit reverse">
                        <button type="submit" class="mdc-button mdc-button--raised" title="{% trans 'Confirm' %}">{% trans 'Confirm' %}</button>
                        {% if wizard.steps.prev %}
                            <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}" class="mdc-button mdc-button">{% trans "Back" %}</button>
                        {% endif %}
                        <a href="{% url 'account:detail' %}" class="mdc-button" title="{% trans 'Cancel' %}">{% trans 'Cancel' %}</a>
                    </div>
                {% endif %}
            </form>
        </div>
    </div>


{% endblock %}
{% block foot %}
    <!-- Keys -->
    <script src="{% static 'app/js/keys.js' %}"></script>
    <script>
        $('#form').saveOnTimes();
        $('#form').nextOnEnter();
    </script>
{% endblock %}